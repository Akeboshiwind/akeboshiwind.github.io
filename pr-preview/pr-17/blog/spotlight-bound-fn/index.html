<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett"><!-- Favicon --><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="shortcut icon" href="/favicon.ico"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"><!-- SEO --><title>Clojure Function Spotlight: bound-fn | Blog by the Rocks</title><meta name="description" content="Clojure Function Spotlight: bound-fn"><link rel="canonical" href="https://blog.bythe.rocks/pr-preview/pr-17/blog/spotlight-bound-fn/"><!-- RSS --><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Blog by the Rocks"><!-- Open Graph --><meta property="og:type" content="article"><meta property="og:url" content="https://blog.bythe.rocks/pr-preview/pr-17/blog/spotlight-bound-fn/"><meta property="og:title" content="Clojure Function Spotlight: bound-fn | Blog by the Rocks"><meta property="og:description" content="Clojure Function Spotlight: bound-fn"><meta property="og:site_name" content="Blog by the Rocks"><meta property="article:published_time" content="2023-11-23T00:00:00.000Z"><!-- Twitter --><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Clojure Function Spotlight: bound-fn | Blog by the Rocks"><meta name="twitter:description" content="Clojure Function Spotlight: bound-fn"><style>:root{--width: 720px;--font-main: Verdana, sans-serif;--font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;--bg: #fff;--text: #444;--heading: #222;--link: #3273dc;--link-visited: #8b6fcb;--code-bg: #f2f2f2;--code-text: #222;--border: #ddd}@media(prefers-color-scheme:dark){:root{--bg: #01242e;--text: #ddd;--heading: #eee;--link: #8cc2dd;--link-visited: #8b6fcb;--code-bg: #000;--code-text: #ddd;--border: #444}}*{box-sizing:border-box}html{font-family:var(--font-main);font-size:16px;line-height:1.6;color:var(--text);background:var(--bg)}body{margin:0 auto;padding:1.25rem;max-width:var(--width)}h1,h2,h3,h4,h5,h6{color:var(--heading);line-height:1.3;margin:1.5em 0 .5em}h1{font-size:1.75rem}h2{font-size:1.5rem}h3{font-size:1.25rem}a{color:var(--link);text-decoration:none}a:hover{text-decoration:underline}a:visited{color:var(--link-visited)}p{margin:1em 0}code{font-family:var(--font-mono);font-size:.9em;padding:.15em .3em;background:var(--code-bg);border-radius:3px}pre{background:var(--code-bg);padding:1em;border-radius:5px;overflow-x:auto;margin:1em 0}pre code{padding:0;background:none}ul,ol{padding-left:1.5em}li{margin:.25em 0}blockquote{border-left:3px solid var(--border);margin:1em 0;padding-left:1em;color:var(--text);font-style:italic}table{width:100%;border-collapse:collapse;margin:1em 0}th,td{border:1px solid var(--border);padding:.5em;text-align:left}img{max-width:100%;height:auto}hr{border:0;border-top:1px dashed var(--border);margin:2em 0}time{font-family:var(--font-mono);font-size:.9rem;color:var(--text)}header{margin-bottom:2em}header nav{display:flex;gap:1rem;flex-wrap:wrap}header .site-title{font-size:1.25rem;font-weight:700;color:var(--heading)}header .site-title:hover{text-decoration:none}footer{margin-top:3em;padding:1em 0;text-align:center;font-size:.875rem;color:var(--text);opacity:.7}.post-list{list-style:none;padding:0}.post-list li{display:flex;gap:1rem;margin:.5em 0;align-items:baseline}.post-list time{flex-shrink:0;width:7rem}.post-list a:visited{color:var(--link-visited)}.draft-marker{color:#c00;font-size:.8em;font-style:italic;margin-left:.5em}.code-with-filename{position:relative;margin:1em 0}.codeblock-name{font-family:var(--font-mono);font-size:.75em;color:#888;position:absolute;top:.5em;left:1em;z-index:1}.code-with-filename pre{padding-top:2em!important}.admonition{margin:1.5em 0;padding:.8em 1em;border-left:4px solid;border-radius:4px}.admonition-title{font-weight:700;margin-bottom:.5em}.admonition-content p:last-child{margin-bottom:0}.admonition-info{background:#5595d61a;border-color:#5595d6}.admonition-info .admonition-title{color:#5595d6}.admonition-warning{background:#ffb9001a;border-color:#ffb900}.admonition-warning .admonition-title{color:#ffb900}.admonition-danger{background:#e74c3c1a;border-color:#e74c3c}.admonition-danger .admonition-title{color:#e74c3c}.admonition-success{background:#2ecc711a;border-color:#2ecc71}.admonition-success .admonition-title{color:#2ecc71}.admonition-note{background:#95a5a61a;border-color:#95a5a6}.admonition-note .admonition-title{color:#95a5a6}@media(prefers-color-scheme:dark){.admonition-info{background:#5595d626}.admonition-info .admonition-title{color:#78aee2}.admonition-warning{background:#ffb90026}.admonition-warning .admonition-title{color:#ffc426}.admonition-danger{background:#e74c3c26}.admonition-danger .admonition-title{color:#e95e4f}.admonition-success{background:#2ecc7126}.admonition-success .admonition-title{color:#40d47e}.admonition-note{background:#95a5a626}.admonition-note .admonition-title{color:#a4b2b3}}
</style></head> <body> <header> <a href="/" class="site-title">Blog by the Rocks</a> <nav> <a href="/">Home</a><a href="/blog/">Blog</a><a href="/tools/">Tools</a><a href="/blog/rss.xml">Feed</a> </nav> </header> <main>  <article> <h1> Clojure Function Spotlight: bound-fn  </h1> <p> <time datetime="2023-11-23"> 2023-11-23 </time> </p> <p>While reading some internal code at <a href="https://juxt.pro">JUXT</a> I came across a function Iâ€™d not seen before: <code>bound-fn</code></p>
<p>After researching a little it turns out to be quite interesting!</p>
<h2 id="starting-with-a-definition">Starting with a definition</h2>
<blockquote>
<p><code>(bound-fn &#x26; fntail)</code></p>
<p>Returns a function defined by the given fntail, which will install the
same bindings in effect as in the thread at the time bound-fn was called.
This may be used to define a helper function which runs on a different
thread, but needs the same bindings in place.</p>
<ul>
<li><a href="https://github.com/clojure/clojure/blob/ce55092f2b2f5481d25cff6205470c1335760ef6/src/clj/clojure/core.clj#L2023">Clojure Source</a></li>
</ul>
</blockquote>
<p>I donâ€™t know about you but mostly that goes in one ear and out the other.</p>
<p>My current understanding of <code>bound-fn</code> is like this: itâ€™s like a normal <a href="https://clojure.org/guides/learn/functions#_closures">closure</a>, but with more <em>reach</em>.</p>
<h2 id="examples">Examples</h2>
<p>An example is worth a thousand words of documentation:</p>
<p>(Thank you <a href="https://clojuredocs.org">ClojureDocs</a>, I donâ€™t know what I would do without you!).</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">def</span><span style="color:#E1E4E8"> ^:dynamic *a* </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> [b </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#F97583">def</span><span style="color:#B392F0"> f1</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">fn</span><span style="color:#E1E4E8"> [] {</span><span style="color:#79B8FF">:a</span><span style="color:#E1E4E8"> *a* </span><span style="color:#79B8FF">:b</span><span style="color:#E1E4E8"> b}))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">f1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">; => {:a 1, :b 3}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#F97583">let</span><span style="color:#E1E4E8"> [b </span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">    (</span><span style="color:#F97583">def</span><span style="color:#B392F0"> f2</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">bound-fn</span><span style="color:#E1E4E8"> [] {</span><span style="color:#79B8FF">:a</span><span style="color:#E1E4E8"> *a* </span><span style="color:#79B8FF">:b</span><span style="color:#E1E4E8"> b}))))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">f2</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">; => {:a 2, :b 3}</span></span></code></pre>
<p>A little contrived, but we can see here that while <code>fn</code> didnâ€™t take the <code>*a*</code> binding with it, the <code>bound-fn</code> did.</p>
<p>One more example to show how this is used in a threading context:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">def</span><span style="color:#E1E4E8"> ^:dynamic *a* </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">defn</span><span style="color:#B392F0"> f</span><span style="color:#E1E4E8"> [] (</span><span style="color:#B392F0">println</span><span style="color:#E1E4E8"> *a*))</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#B392F0">f</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">; => 1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#B392F0">f</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#6A737D">; => 2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#B392F0">.start</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Thread.</span><span style="color:#E1E4E8"> f)))</span></span>
<span class="line"><span style="color:#6A737D">; => 1</span></span>
<span class="line"><span style="color:#6A737D">; If you didn't see this in your repl, maybe try this: https://stackoverflow.com/a/26744120</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">2</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#B392F0">.start</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Thread.</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">bound-fn*</span><span style="color:#E1E4E8"> f))))</span></span>
<span class="line"><span style="color:#6A737D">; => 2</span></span>
<span class="line"><span style="color:#6A737D">; As this has captured the parent bindings, *out* should also be captured so this should print in your repl even if the above did not.</span></span></code></pre>
<p>This seems kinda handy!</p>
<p>For example, say youâ€™ve got some dynamic variable and youâ€™re using some lazy functions.
If you realise the value in the incorrect scope:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">def</span><span style="color:#E1E4E8"> ^:dynamic *a* </span><span style="color:#B392F0">nil</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#B392F0">->></span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">range</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">       (</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8"> #(</span><span style="color:#B392F0">+</span><span style="color:#E1E4E8"> *a* %))))</span></span>
<span class="line"><span style="color:#6A737D">; (err) Error printing return value (NullPointerException) at clojure.lang.Numbers/ops (Numbers.java:1095).</span></span>
<span class="line"><span style="color:#6A737D">; (err) Cannot invoke "Object.getClass()" because "x" is null</span></span></code></pre>
<p>(Side note, that error isnâ€™t very helpful ðŸ¤”)</p>
<p>Oh no!
But <code>bound-fn*</code> comes to the rescue:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="clojure"><code><span class="line"><span style="color:#E1E4E8">(</span><span style="color:#F97583">binding</span><span style="color:#E1E4E8"> [*a* </span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">]</span></span>
<span class="line"><span style="color:#E1E4E8">  (</span><span style="color:#B392F0">->></span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">range</span><span style="color:#79B8FF"> 10</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">       (</span><span style="color:#B392F0">map</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">bound-fn*</span><span style="color:#E1E4E8"> #(</span><span style="color:#B392F0">+</span><span style="color:#E1E4E8"> *a* %)))))</span></span>
<span class="line"><span style="color:#6A737D">; => (1 2 3 4 5 6 7 8 9 10)</span></span></code></pre>
<p>And now our (imaginary) problem is solved!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Obviously this isnâ€™t a function you or I are going to use every day.
But when you need it, itâ€™s a handy tool to have in your belt!</p>
<p>I find that clojure core has lots of interesting treasures, many libraries do!
Itâ€™s exciting when you find a new function, testing what it can do and thinking about how it could help you is fun.</p>
<p>Make sure to let me know if you find anything interesting, or find an interesting use for <code>bound-fn</code> in your code.</p>  <p> <a href="https://github.com/Akeboshiwind/akeboshiwind.github.io/discussions/4">Discuss this post</a> </p> </article>  </main> <footer> <p>&copy; 2026 Blog by the Rocks</p> </footer> </body></html>